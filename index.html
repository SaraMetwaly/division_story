<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>رحلة الأرقام إلى مدينة الملاهي 🎡 — لعبة القسمة المطوّلة </title>
<style>
  :root{--bg:#fff9f1;--panel:#ffffff;--accent:#6a5acd;--text:#1f2d3d;--muted:#6b7280;--shadow:0 8px 24px rgba(0,0,0,.08)}
  *{box-sizing:border-box}
  body{margin:0;font-family:"Tahoma","Segoe UI",system-ui,-apple-system,Arial,sans-serif;background:var(--bg);color:var(--text);line-height:1.8}
  header{background:linear-gradient(135deg,#ffd27f 0%,#ff9fb2 50%,#c1b4ff 100%);padding:24px 16px 28px;text-align:center;color:#1b1732}
  h1{margin:0 0 6px;font-size:28px}.sub{opacity:.9;font-size:16px}
  .container{max-width:1100px;margin:-24px auto 80px;padding:0 16px}
  .card{background:var(--panel);border-radius:16px;box-shadow:var(--shadow);padding:18px;margin:14px 0}
  .row{display:flex;flex-wrap:wrap;gap:16px}.col{flex:1 1 320px}
  label{display:block;margin:.25rem 0 .35rem;font-weight:700}
  input{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #e5e7eb;font-size:18px}
  button{border:0;border-radius:12px;padding:12px 16px;font-size:16px;cursor:pointer;transition:.2s;box-shadow:var(--shadow)}
  .primary{background:var(--accent);color:#fff}.secondary{background:#eef2ff;color:#4338ca}.ghost{background:#f1f5f9;color:#0f172a}
  button:disabled{opacity:.5;cursor:not-allowed}
  .hint{color:var(--muted);font-size:14px}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:#fefce8;border:1px dashed #fde68a;color:#7c2d12}
  .board{display:flex;gap:16px;align-items:stretch;flex-wrap:wrap}
  .gate,.queue,.work{flex:1 1 280px;background:#f8fafc;border:1px solid #e2e8f0;border-radius:14px;padding:14px}
  .title{font-weight:800;margin-bottom:8px}
  .digits{display:flex;gap:8px;flex-wrap:wrap}
  .digit{min-width:44px;padding:10px 12px;border-radius:12px;background:#fff;border:1px solid #e5e7eb;text-align:center;font-weight:800;font-size:20px;box-shadow:var(--shadow)}
  .digit.active{outline:3px solid #60a5fa}
  .qbtns{display:grid;grid-template-columns:repeat(5,minmax(56px,1fr));gap:8px;margin-top:8px}
  .qbtns button{padding:10px 0;font-weight:800;background:#e0f2fe;color:#075985}
  .log{max-height:220px;overflow:auto;border:1px dashed #e5e7eb;border-radius:12px;padding:8px;background:#fff}
  .math{display:flex;align-items:flex-end;gap:10px;font-family:"Consolas","Courier New",monospace;background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:10px;min-height:70px}
  .math .item{padding:0 6px}
  .ok{background:#dcfce7;color:#14532d}.no{background:#fee2e2;color:#7f1d1d}
  .footer-note{font-size:12px;color:#6b7280;text-align:center;margin-top:10px}
  .status{margin-top:8px}
</style>
</head>
<body>
<header>
  <h1>رحلة الأرقام إلى مدينة الملاهي 🎡</h1>
</header>

<div class="container">
  <div class="card">
    <div class="row">
      <div class="col">
        <label>المقسوم (الرقم الذي يريد الدخول):</label>
        <input id="dividend" type="text" value="234" inputmode="numeric" autocomplete="off" />
      </div>
      <div class="col">
        <label>المقسوم عليه (الحارس عند البوابة):</label>
        <input id="divisor" type="text" value="3" inputmode="numeric" />
      </div>
    </div>
    <div class="row" style="margin-top:10px">
      <div class="col">
        <button id="startBtn" class="primary" onclick="startGame()">ابدئي الرحلة 🚀</button>
        <button class="ghost" onclick="resetGame()">إعادة ضبط</button>
      </div>
    </div>
    <div id="status" class="status"></div>
  </div>

  <div class="card">
    <div class="title">القصة: "الحارس" يعلن شرط الدخول</div>
    <div class="hint">يُسمح بالدخول لمن كان أكبر من أو يساوي أحد <strong>مضاعفات</strong> الحارس. سجّل الحارس كل مجموعة في "دفتر الدخول" (الناتج).</div>
    <div id="multiples" class="digits" style="margin-top:8px"></div>
  </div>

  <div class="card board">
    <div class="queue">
      <div class="title">طابور الأرقام (المقسوم)</div>
      <div id="queue" class="digits"></div>
      <div style="margin-top:10px;display:flex;gap:10px;align-items:center">
        <button id="bringBtn" class="secondary" onclick="bringDown()" disabled>أنزلي الرقم التالي ⬇️</button>
        <span id="bringMsg" class="hint"></span>
      </div>
    </div>

    <div class="gate">
      <div class="title">بوابة الحارس 👮‍♂️ (المقسوم عليه = <span id="dText">–</span>)</div>
      <div class="math" id="mathArea">
        <div class="item">ناتج: <strong id="quotient">–</strong></div>
        <div class="item">|</div>
        <div class="item">الحالي: <strong id="current">–</strong></div>
        <div class="item">الباقي: <strong id="remainder">–</strong></div>
      </div>
      <div id="choiceWrap" style="margin-top:10px; display:none">
        <div class="hint">اختاري كم مرة يدخل الحارس في العدد الحالي (أكبر عدد لا يتجاوزه):</div>
        <div class="qbtns" id="choices"></div>
      </div>
      <div id="feedback" style="margin-top:8px"></div>
    </div>

    <div class="work">
      <div class="title">دفتر العمليات ✍️</div>
      <div class="log" id="log"></div>
      <div class="footer-note">سجّل هنا ما حدث في كل خطوة: الإنزال ➜ الاختيار ➜ الطرح ➜ الباقي ➜ الإنزال...</div>
    </div>
  </div>


</div>

<script>
  // تحويل الأرقام العربية/الفارسية إلى لاتينية وجمع الأرقام فقط (بدون أي إضافات)
  function toAsciiDigitsOnly(s){
    const map = {
      '٠':'0','١':'1','٢':'2','٣':'3','٤':'4','٥':'5','٦':'6','٧':'7','٨':'8','٩':'9',
      '۰':'0','۱':'1','۲':'2','۳':'3','۴':'4','۵':'5','۶':'6','۷':'7','۸':'8','۹':'9'
    };
    let out = "";
    for(const ch of String(s||"")){
      if(ch >= '0' && ch <= '9'){ out += ch; continue; }
      if(map[ch] !== undefined){ out += map[ch]; continue; }
      // غير ذلك نتجاهله
    }
    return out;
  }

  let state = {digits:[],idx:0,divisor:0,current:"",quotient:"",remainder:0,done:false,awaitingChoice:false};

  function setStatus(msg){
    const el = document.getElementById('status');
    el.innerHTML = msg ? `<span class="pill">ℹ️ ${msg}</span>` : "";
  }

  function logMsg(html){
    const el = document.getElementById('log'); const row = document.createElement('div');
    row.innerHTML = html; el.prepend(row);
  }

  function paintQueue(){
    const q = document.getElementById('queue'); q.innerHTML = "";
    state.digits.forEach((d,i)=>{
      const div = document.createElement('div');
      div.className = "digit" + (i===state.idx?" active":""); div.textContent = d; q.appendChild(div);
    });
  }

  function paintMultiples(){
    const m = document.getElementById('multiples'); m.innerHTML = "";
    if(!state.divisor) return;
    for(let i=1;i<=10;i++){
      const div = document.createElement('div'); div.className="digit";
      div.textContent = `${state.divisor} × ${i} = ${state.divisor*i}`;
      m.appendChild(div);
    }
  }

  function updateTop(){
    document.getElementById('dText').textContent = state.divisor||"–";
    document.getElementById('quotient').textContent = state.quotient||"0";
    document.getElementById('current').textContent = state.current||"0";
    document.getElementById('remainder').textContent = state.remainder||"0";
  }

  function startGame(){
    const rawDividend = document.getElementById('dividend').value;
    const rawDivisor = document.getElementById('divisor').value;

    const dividendStr = toAsciiDigitsOnly(rawDividend);
    const divisorStr  = toAsciiDigitsOnly(rawDivisor);

    const divisor = Number(divisorStr);
    if(!Number.isFinite(divisor) || divisor === 0){
      setStatus("أدخلي رقمًا صحيحًا للحارس (المقسوم عليه) وغير صفري مثل 2 أو 3.");
      return;
    }
    setStatus("");

    state = {
      digits: (dividendStr || "0").split(""),
      idx:0,
      divisor:divisor,
      current:"",
      quotient:"",
      remainder:0,
      done:false,
      awaitingChoice:false
    };

    paintMultiples();
    paintQueue();
    document.getElementById('bringBtn').disabled = false;
    document.getElementById('bringMsg').textContent = "ابدئي بإنزال الرقم الأول من الطابور.";
    document.getElementById('choices').innerHTML="";
    document.getElementById('choiceWrap').style.display = "none";
    document.getElementById('feedback').innerHTML="";
    document.getElementById('log').innerHTML="";
    updateTop();
  }

  function resetGame(){
    state = {digits:[],idx:0,divisor:0,current:"",quotient:"",remainder:0,done:false,awaitingChoice:false};
    document.getElementById('multiples').innerHTML="";
    document.getElementById('queue').innerHTML="";
    document.getElementById('choices').innerHTML="";
    document.getElementById('choiceWrap').style.display="none";
    document.getElementById('feedback').innerHTML="";
    document.getElementById('bringBtn').disabled = true;
    document.getElementById('bringMsg').textContent = "";
    document.getElementById('log').innerHTML="";
    setStatus("");
    updateTop();
  }

  function bringDown(){
    if(state.done) return;
    if(state.awaitingChoice){ return; }
    if(state.idx >= state.digits.length){
      document.getElementById('bringMsg').textContent = "لا مزيد من الأرقام في الطابور.";
      return;
    }
    state.current = String(state.current||"") + String(state.digits[state.idx]);
    logMsg(`🎫 انضم الرقم <strong>${state.digits[state.idx]}</strong> من الطابور ➜ أصبح الحالي <strong>${state.current}</strong>.`);
    state.idx += 1;
    paintQueue();
    updateTop();

    const cur = Number(state.current);
    if(cur < state.divisor && state.idx < state.digits.length){
      state.quotient += "0";
      logMsg(`⏳ ${cur} أصغر من ${state.divisor} ➜ سجّل الحارس 0 في الدفتر.`);
      updateTop();
      document.getElementById('bringMsg').textContent = "أحسنتِ! أنزلي رقمًا آخر.";
      document.getElementById('choiceWrap').style.display = "none";
      return;
    }

    if(cur >= state.divisor){
      showChoices();
      document.getElementById('bringMsg').textContent = "اختاري كم مرة يدخل الحارس.";
    }else{
      finish(true);
    }
  }

  function showChoices(){
    state.awaitingChoice = true;
    document.getElementById('bringBtn').disabled = true;

    const cur = Number(state.current);
    const correct = Math.floor(cur / state.divisor);
    const set = new Set([correct]);
    while(set.size<8){
      const r = Math.max(0, correct + Math.floor(Math.random()*7)-3);
      set.add(r);
    }
    const arr = Array.from(set).slice(0,8).sort((a,b)=>a-b);
    const wrap = document.getElementById('choices'); wrap.innerHTML = "";
    arr.forEach(n=>{
      const b = document.createElement('button'); b.textContent = n;
      b.onclick = ()=> chooseQuotient(n); wrap.appendChild(b);
    });
    document.getElementById('choiceWrap').style.display = "block";
  }

  function chooseQuotient(n){
    if(!state.awaitingChoice) return;
    const cur = Number(state.current);
    const correct = Math.floor(cur/state.divisor);
    const fb = document.getElementById('feedback');
    if(n!==correct){ fb.innerHTML = `<span class="no">حاولي مرة أخرى</span>`; return; }
    state.quotient += String(n);
    const product = n * state.divisor;
    const remainder = cur - product;
    state.current = String(remainder);
    state.remainder = remainder;
    fb.innerHTML = `<span class="ok">✔︎ صحيح</span> ${state.divisor} × ${n} = ${product} — الباقي ${remainder}.`;
    logMsg(`✅ طرحنا ${product} من ${cur} ➜ الباقي <strong>${remainder}</strong>.`);
    updateTop();
    document.getElementById('choiceWrap').style.display = "none";
    state.awaitingChoice = false;
    document.getElementById('bringBtn').disabled = false;

    if(state.idx >= state.digits.length){ finish(false); }
    else{ document.getElementById('bringMsg').textContent = "أنزلي الرقم التالي."; }
  }

  function finish(smallAtEnd){
    state.done = true; state.awaitingChoice = false;
    document.getElementById('bringBtn').disabled = true;
    const rem = smallAtEnd ? Number(state.current||"0") : state.remainder||0;
    const msg = `🎉 انتهت الرحلة: الناتج <strong>${state.quotient||0}</strong> والباقي <strong>${rem}</strong>.`;
    logMsg(msg);
    document.getElementById('feedback').innerHTML = `<span class="pill">🎊 ${msg}</span>`;
  }

  // اختصار: Enter = إنزال، الأرقام = اختيار
  document.addEventListener('keydown', (e)=>{
    const active = document.activeElement;
    if(active && (active.tagName === 'INPUT' || active.isContentEditable)) return;
    if(e.key === 'Enter'){
      if(!state.awaitingChoice && !document.getElementById('bringBtn').disabled){ bringDown(); }
    }
    if(/^[0-9]$/.test(e.key) && state.awaitingChoice){ chooseQuotient(Number(e.key)); }
  });
</script>
</body>
</html>
